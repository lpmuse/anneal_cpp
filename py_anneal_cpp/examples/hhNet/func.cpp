#define NX 4  // dim of state variable + number of parameters
#define NS 1  // number of stimuli

using namespace alglib;

void func_origin(real_1d_array &x, int it, real_2d_array &sti, real_1d_array &dxdt);
void func_DF(real_1d_array &x, int it, real_2d_array &sti, real_2d_array &Jac);

// hhNet vector field
void func_origin(real_1d_array &x, int it, real_2d_array &sti, real_1d_array &dxdt)
{
    dxdt[0] = 0.01*sti[it][0] - 0.3*x[0] + 1.2*x[2]*pow(x[1], 3)*(-100.0*x[0] + 125.0) + 0.36*pow(x[3], 4)*(-100.0*x[0] - 2.0) + 0.061839;
    dxdt[1] = -6.97163599453383*x[1]*exp(-5.55555555555556*x[0]) - 0.1*(-x[1] + 1)/(0.0644695028438448*pow(x[0], 24) - 0.702717580997908*pow(x[0], 23) + 3.86397965294583*pow(x[0], 22) - 14.4579468251363*pow(x[0], 21) + 41.9606512439586*pow(x[0], 20) - 102.047862961894*pow(x[0], 19) + 218.739917521137*pow(x[0], 18) - 426.8477644025*pow(x[0], 17) + 772.437418829815*pow(x[0], 16) - 1307.14571010939*pow(x[0], 15) + 2072.31032610844*pow(x[0], 14) - 3072.18287084275*pow(x[0], 13) + 4242.35699419902*pow(x[0], 12) - 5428.47887272987*pow(x[0], 11) + 6396.11593598618*pow(x[0], 10) - 6887.0818501852*pow(x[0], 9) + 6715.2504591331*pow(x[0], 8) - 5862.81977289568*pow(x[0], 7) + 4518.5392188703*pow(x[0], 6) - 3017.8795957877*pow(x[0], 5) + 1703.36313751617*pow(x[0], 4) - 783.633400107481*pow(x[0], 3) + 277.652509271461*pow(x[0], 2) - 68.3988815483435*x[0] + 9.17584341676912);
    dxdt[2] = -1.0*x[2]/(54.5981500331442*exp(-10.0*x[0]) + 1.0) + 0.115410488949009*(-x[2] + 1)*exp(-5.0*x[0]);
    dxdt[3] = -0.141643556633353*x[3]*exp(-1.25*x[0]) - 0.01*(-x[3] + 1)/(0.0644695028438448*pow(x[0], 24) - 0.470627370760067*pow(x[0], 23) + 1.83995961116333*pow(x[0], 22) - 5.26664262631936*pow(x[0], 21) + 12.64773021911*pow(x[0], 20) - 27.3387620189131*pow(x[0], 19) + 54.9995868547208*pow(x[0], 18) - 104.28470549243*pow(x[0], 17) + 186.833885278086*pow(x[0], 16) - 315.775063090833*pow(x[0], 15) + 501.893510914162*pow(x[0], 14) - 747.199968378754*pow(x[0], 13) + 1037.17151833852*pow(x[0], 12) - 1335.16093659646*pow(x[0], 11) + 1584.08214807981*pow(x[0], 10) - 1719.40934622843*pow(x[0], 9) + 1692.34390746188*pow(x[0], 8) - 1494.13441763583*pow(x[0], 7) + 1167.25567578352*pow(x[0], 6) - 792.806656361375*pow(x[0], 5) + 457.193343638609*pow(x[0], 4) - 216.438668727722*pow(x[0], 3) + 79.8632012366331*pow(x[0], 2) - 20.9726402473266*x[0] + 3.19452804946533);
}

//hhNet Jacobian matrix
void func_DF(real_1d_array &x, int it, real_2d_array &sti, real_2d_array &Jac)
{
    Jac[0][0] = -120.0*x[2]*pow(x[1], 3) - 36.0*pow(x[3], 4) - 0.3;
    Jac[0][1] = 3.6*x[2]*pow(x[1], 2)*(-100.0*x[0] + 125.0);
    Jac[0][2] = 1.2*pow(x[1], 3)*(-100.0*x[0] + 125.0);
    Jac[0][3] = 1.44*pow(x[3], 3)*(-100.0*x[0] - 2.0);
    Jac[1][0] = 38.7313110807435*x[1]*exp(-5.55555555555556*x[0]) - 0.1*(-x[1] + 1)*(-1.54726806825227*pow(x[0], 23) + 16.1625043629519*pow(x[0], 22) - 85.0075523648083*pow(x[0], 21) + 303.616883327863*pow(x[0], 20) - 839.213024879173*pow(x[0], 19) + 1938.90939627599*pow(x[0], 18) - 3937.31851538046*pow(x[0], 17) + 7256.4119948425*pow(x[0], 16) - 12358.998701277*pow(x[0], 15) + 19607.1856516408*pow(x[0], 14) - 29012.3445655181*pow(x[0], 13) + 39938.3773209557*pow(x[0], 12) - 50908.2839303882*pow(x[0], 11) + 59713.2676000285*pow(x[0], 10) - 63961.1593598618*pow(x[0], 9) + 61983.7366516668*pow(x[0], 8) - 53722.0036730648*pow(x[0], 7) + 41039.7384102698*pow(x[0], 6) - 27111.2353132218*pow(x[0], 5) + 15089.3979789385*pow(x[0], 4) - 6813.45255006469*pow(x[0], 3) + 2350.90020032244*pow(x[0], 2) - 555.305018542921*x[0] + 68.3988815483435)/pow(0.0644695028438448*pow(x[0], 24) - 0.702717580997908*pow(x[0], 23) + 3.86397965294583*pow(x[0], 22) - 14.4579468251363*pow(x[0], 21) + 41.9606512439586*pow(x[0], 20) - 102.047862961894*pow(x[0], 19) + 218.739917521137*pow(x[0], 18) - 426.8477644025*pow(x[0], 17) + 772.437418829815*pow(x[0], 16) - 1307.14571010939*pow(x[0], 15) + 2072.31032610844*pow(x[0], 14) - 3072.18287084275*pow(x[0], 13) + 4242.35699419902*pow(x[0], 12) - 5428.47887272987*pow(x[0], 11) + 6396.11593598618*pow(x[0], 10) - 6887.0818501852*pow(x[0], 9) + 6715.2504591331*pow(x[0], 8) - 5862.81977289568*pow(x[0], 7) + 4518.5392188703*pow(x[0], 6) - 3017.8795957877*pow(x[0], 5) + 1703.36313751617*pow(x[0], 4) - 783.633400107481*pow(x[0], 3) + 277.652509271461*pow(x[0], 2) - 68.3988815483435*x[0] + 9.17584341676912, 2);
    Jac[1][1] = -6.97163599453383*exp(-5.55555555555556*x[0]) + 0.1/(0.0644695028438448*pow(x[0], 24) - 0.702717580997908*pow(x[0], 23) + 3.86397965294583*pow(x[0], 22) - 14.4579468251363*pow(x[0], 21) + 41.9606512439586*pow(x[0], 20) - 102.047862961894*pow(x[0], 19) + 218.739917521137*pow(x[0], 18) - 426.8477644025*pow(x[0], 17) + 772.437418829815*pow(x[0], 16) - 1307.14571010939*pow(x[0], 15) + 2072.31032610844*pow(x[0], 14) - 3072.18287084275*pow(x[0], 13) + 4242.35699419902*pow(x[0], 12) - 5428.47887272987*pow(x[0], 11) + 6396.11593598618*pow(x[0], 10) - 6887.0818501852*pow(x[0], 9) + 6715.2504591331*pow(x[0], 8) - 5862.81977289568*pow(x[0], 7) + 4518.5392188703*pow(x[0], 6) - 3017.8795957877*pow(x[0], 5) + 1703.36313751617*pow(x[0], 4) - 783.633400107481*pow(x[0], 3) + 277.652509271461*pow(x[0], 2) - 68.3988815483435*x[0] + 9.17584341676912);
    Jac[1][2] = 0;
    Jac[1][3] = 0;
    Jac[2][0] = -545.981500331442*x[2]*exp(-10.0*x[0])/pow(54.5981500331442*exp(-10.0*x[0]) + 1.0, 2) - 0.577052444745045*(-x[2] + 1)*exp(-5.0*x[0]);
    Jac[2][1] = 0;
    Jac[2][2] = -0.115410488949009*exp(-5.0*x[0]) - 1.0/(54.5981500331442*exp(-10.0*x[0]) + 1.0);
    Jac[2][3] = 0;
    Jac[3][0] = 0.177054445791692*x[3]*exp(-1.25*x[0]) - 0.01*(-x[3] + 1)*(-1.54726806825227*pow(x[0], 23) + 10.8244295274815*pow(x[0], 22) - 40.4791114455932*pow(x[0], 21) + 110.599495152707*pow(x[0], 20) - 252.9546043822*pow(x[0], 19) + 519.436478359348*pow(x[0], 18) - 989.992563384974*pow(x[0], 17) + 1772.83999337132*pow(x[0], 16) - 2989.34216444938*pow(x[0], 15) + 4736.62594636249*pow(x[0], 14) - 7026.50915279827*pow(x[0], 13) + 9713.5995889238*pow(x[0], 12) - 12446.0582200623*pow(x[0], 11) + 14686.7703025611*pow(x[0], 10) - 15840.8214807981*pow(x[0], 9) + 15474.6841160559*pow(x[0], 8) - 13538.751259695*pow(x[0], 7) + 10458.9409234508*pow(x[0], 6) - 7003.53405470113*pow(x[0], 5) + 3964.03328180688*pow(x[0], 4) - 1828.77337455443*pow(x[0], 3) + 649.316006183166*pow(x[0], 2) - 159.726402473266*x[0] + 20.9726402473266)/pow(0.0644695028438448*pow(x[0], 24) - 0.470627370760067*pow(x[0], 23) + 1.83995961116333*pow(x[0], 22) - 5.26664262631936*pow(x[0], 21) + 12.64773021911*pow(x[0], 20) - 27.3387620189131*pow(x[0], 19) + 54.9995868547208*pow(x[0], 18) - 104.28470549243*pow(x[0], 17) + 186.833885278086*pow(x[0], 16) - 315.775063090833*pow(x[0], 15) + 501.893510914162*pow(x[0], 14) - 747.199968378754*pow(x[0], 13) + 1037.17151833852*pow(x[0], 12) - 1335.16093659646*pow(x[0], 11) + 1584.08214807981*pow(x[0], 10) - 1719.40934622843*pow(x[0], 9) + 1692.34390746188*pow(x[0], 8) - 1494.13441763583*pow(x[0], 7) + 1167.25567578352*pow(x[0], 6) - 792.806656361375*pow(x[0], 5) + 457.193343638609*pow(x[0], 4) - 216.438668727722*pow(x[0], 3) + 79.8632012366331*pow(x[0], 2) - 20.9726402473266*x[0] + 3.19452804946533, 2);
    Jac[3][1] = 0;
    Jac[3][2] = 0;
    Jac[3][3] = -0.141643556633353*exp(-1.25*x[0]) + 0.01/(0.0644695028438448*pow(x[0], 24) - 0.470627370760067*pow(x[0], 23) + 1.83995961116333*pow(x[0], 22) - 5.26664262631936*pow(x[0], 21) + 12.64773021911*pow(x[0], 20) - 27.3387620189131*pow(x[0], 19) + 54.9995868547208*pow(x[0], 18) - 104.28470549243*pow(x[0], 17) + 186.833885278086*pow(x[0], 16) - 315.775063090833*pow(x[0], 15) + 501.893510914162*pow(x[0], 14) - 747.199968378754*pow(x[0], 13) + 1037.17151833852*pow(x[0], 12) - 1335.16093659646*pow(x[0], 11) + 1584.08214807981*pow(x[0], 10) - 1719.40934622843*pow(x[0], 9) + 1692.34390746188*pow(x[0], 8) - 1494.13441763583*pow(x[0], 7) + 1167.25567578352*pow(x[0], 6) - 792.806656361375*pow(x[0], 5) + 457.193343638609*pow(x[0], 4) - 216.438668727722*pow(x[0], 3) + 79.8632012366331*pow(x[0], 2) - 20.9726402473266*x[0] + 3.19452804946533);
}
